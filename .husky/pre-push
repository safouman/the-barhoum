#!/usr/bin/env sh

set -e

if git rev-parse --abbrev-ref --symbolic-full-name @{u} >/dev/null 2>&1; then
    CHANGED_FILES="$(git diff --name-only @{u}...HEAD)"
else
    CHANGED_FILES="$(git diff --name-only HEAD)"
fi

SKIP_CHECKS=true

if [ -z "$CHANGED_FILES" ]; then
    SKIP_CHECKS=false
fi

for file in $CHANGED_FILES; do
    case "$file" in
        public/video/promo-hls/*|public/video/promo.mp4|public/video/promo-poster.jpg)
            ;;
        *)
            SKIP_CHECKS=false
            break
            ;;
    esac
done

if [ "$SKIP_CHECKS" = "true" ]; then
    echo "husky (pre-push): skipping build/check for HLS asset updates."
    exit 0
fi

npm run check
npm run build
